name: DDL Syntax Check

on:
  pull_request:
    paths:
      - '**/sql/**'

jobs:
  ddl-syntax-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      
      - name: Install SQLFluff
        run: pip install sqlfluff
      
      - name: DDL Syntax Check Only
        run: |
          changed_files=$(git diff --name-only origin/main...HEAD | grep '\.sql$' || echo "")
          
          if [ -z "$changed_files" ]; then
            echo "âœ… No SQL files changed"
            exit 0
          fi
          
          for file in $changed_files; do
            echo "ğŸ” Checking DDL syntax: $file"
            
            # ë¬¸ë²• ì˜¤ë¥˜ë§Œ ì²´í¬ (ëª¨ë“  ìŠ¤íƒ€ì¼ ê·œì¹™ ì œì™¸)
            sqlfluff parse --dialect $dialect "$file"
            
            if [ $? -eq 0 ]; then
              echo "  âœ… DDL syntax valid"
            else
              echo "  âŒ DDL syntax error"
              exit 1
            fi
          done